<!-- ###ALL### -->

/*<![CDATA[*/ 

function makeMap() {
  if (GBrowserIsCompatible()) {

		###SELECTED_CAT###
		
		map = new GMap2(document.getElementById("###MAP_DIV###"));
		gdir=new GDirections(map, document.getElementById("getdirections"));    
		geocoder = new GClientGeocoder();
		new GKeyboardHandler(map);
		boundsgeneral = new GLatLngBounds();
		
		
		
		map.addMapType(G_PHYSICAL_MAP);
		map.setCenter(new GLatLng(###MAP_LAT###, ###MAP_LNG###), ###MAP_ZOOM###);
		
		###SETTINGS###
		//map.addControl(new GOverviewMapControl(new GSize(200,200)));
		//setTimeout("positionOverview(10,60)",10);
		
		//###__MAKEMAP### 
		
		getXMLData(1);
		
		// create the clusterer
		cat =   document.getElementById("mapcatlist").innerHTML;
		
		GEvent.addListener(map, 'moveend', function() {
			
			myXmlVar="###URL###&tx_rggooglemap_pi1[cat]="+cat+"&tx_rggooglemap_pi1[area]=" + getBound() + "&tx_rggooglemap_pi1[zoom]="+map.getZoom()+"&r=" + Math.random();
						
			if(!stopReload) {
				getXMLData(123);
			}
			stopReload=false;
		});
		
		###HIDECONTROLSMOUSEOUT###
		

		
		###POI_ON_START###
		
		// general bound
		var zoom=map.getBoundsZoomLevel(boundsgeneral);
		var centerLat = (boundsgeneral.getNorthEast().lat() + boundsgeneral.getSouthWest().lat()) /2;
		var centerLng = (boundsgeneral.getNorthEast().lng() + boundsgeneral.getSouthWest().lng()) /2;
	//	map.setCenter(new GLatLng(centerLat,centerLng),zoom);
 

  }
}

function getXMLData(clearOverlay) {
  // getCategories
  cat =   document.getElementById("mapcatlist").innerHTML;
  myXmlVar="###URL###&tx_rggooglemap_pi1[cat]="+cat+"&tx_rggooglemap_pi1[area]=" + getBound() + "&tx_rggooglemap_pi1[zoom]="+map.getZoom()+"&r=" + Math.random();

  
  var request = GXmlHttp.create();
  request.open("GET", myXmlVar, true);
  request.onreadystatechange = function() {
    if (request.readyState == 4) {
      
      var xmlDoc = request.responseXML;
      
      // obtain the array of markers and loop through it
      var markers = xmlDoc.documentElement.getElementsByTagName("marker");
      var clusterer = new Clusterer(map);


      if (clearOverlay ==12) {
        map.clearOverlays();gmarkers.length = 0;
        setTimeout('getXMLData(11)', 100000);
        
      }

        if(d("rggooglemap-recordsonmap")){tx_rggooglemap_pi1activeRecords(getBound()); }
      
      
     var rggmbound =document.getElementById('rggmBound');
     if (rggmbound )  { rggmbound.value = getBound(); }
     
     //x  document.getElementById('coordinfo').innerHTML= markers.length + " ---- "+test+"<a href=\" "+myXmlVar+"\">XML<&#47;a>";
      for (var i = 0; i < markers.length; i++) {

        // obtain the attribues of each marker
        var lat = parseFloat(markers[i].getAttribute("lat"));
        var lng = parseFloat(markers[i].getAttribute("lng"));
        var point = new GLatLng(lat,lng);
        var title = [GXml.value(markers[i].getElementsByTagName("t")[0]) ];
        var id = parseFloat(markers[i].getAttribute("uid"));
        var table = markers[i].getAttribute("table");
        var img = markers[i].getAttribute("img");
        
        marker = createMarker(point, id, img, title, table);
clusterer.RemoveMarker( marker );

        if (!gmarkers[id]) {
          gmarkers[id] = marker;          
          //clusterer.AddMarker(marker,title);
          
          ###ADD_MARKER###
        } 
        
      }     
    }    
  }
  
  request.send(null);
}

function createMarker(point, id, img, title,table) {   
	var icon = new GIcon(baseIcon);
	icon.image = "###URL_ICONS###"+img;
	
	// var marker = new GxMarker( point, icon, ""+ title, { "offset": new GSize(10, -20), "isStatic": false } );
	var marker = new GxMarker( point, icon, ""+title );
	//var marker = new GMarker (point);
	
	// var marker = new GxMarker( point, "http://www.rggooglemap.com/uploads/tx_rggooglemap/VirtError_02.gif", ""+title );
	var url = "###URL###&no_cache=1&tx_rggooglemap_pi1[detail]="+id+"&tx_rggooglemap_pi1[table]="+table;

	GEvent.addListener(marker, "click", function() {
		
		var req = GXmlHttp.create();
		req.open("GET", url, true );
		req.onreadystatechange = function() {
			if ( req.readyState == 4 ) {
				marker.openInfoWindowHtml( req.responseText );
			}
		};
		req.send(null);
		
	});
	return marker;
}  

 // This function picks up the click and opens the corresponding info window 
function myclick(i, lng, lat, table,showMarker) {
	
	var req = GXmlHttp.create();
	var url = "###URL###&type=500&no_cache=1&tx_rggooglemap_pi1[detail]="+i+"&tx_rggooglemap_pi1[table]="+table;
	
	req.open("GET", url, true);
	var t=this;
	req.onreadystatechange = function() {
		if ( req.readyState == 4 ) {
			t.map.openInfoWindowHtml( new GLatLng(lat, lng), req.responseText );
		}
	};
	req.send(null);
	

}; 


function clearCat() {
	test = true;
	map.clearOverlays();
	gmarkers.length = 0;
	setTimeout("getXMLData(12);",1000);

}


<!-- ###ALL### -->